:javascript
  <!--
  var newwindow;
  function poptastic(url)
  { 
    newwindow=window.open(url,'Print','width=600,left=200,top=50,toolbar=no,status=no');
    if (window.focus) {newwindow.focus()}
  }
  //-->
.row
  .large-12.columns
    %h2
      = @basket.name
.row
  .small-5.columns
    = form_tag edit_basket_path(@basket) , :method => :get do |f|
      = label_tag :ean
      = text_field_tag :ean , "" , :autofocus => true
  .small-5.columns
    = t(:discount )
    = form_tag edit_basket_path(@basket) , :method => :get do
      = select_tag("discount" , options_for_select( ["",0,5,10,15,20,25,30,35,40,50,60,70] ), :onchange => 'this.form.submit()')
.row
  = form_for(@basket) do |f|
    %table.table.table-striped.table-bordered.table-condensed
      %thead
        %tr
          %th= t(:picture)
          %th= t(:name)
          %th= t(:quantity)
          %th= t(:price)
          %th= t(:discount)
          %th{:colspan => "3"}= t(:actions)
      %tbody
        - @basket.items.each do |item|
          %tr{:class => "line-#{cycle("1","2")}"}
            %td= image_tag item.product.main_picture.url if item.product
            %td= item.product.name if item.product
            = f.simple_fields_for :items , item do |iform|
              %td= iform.text_field :quantity , :label => false
              %td= iform.text_field :price , :label => false
            %td
              = select_tag("discount" , options_for_select( [item.discount,0,5,10,15,20,25,30,35,40,50,60,70] ), :onchange => "window.location.href='#{edit_basket_path(@basket)}?item=#{item.id}&discount=' + this.value"  )
            %td
              = link_to t(:delete) , edit_basket_path(:delete => item.id) 
              = link_to t(:add) , edit_basket_path(:add => item.id) 
          
        %tr
          %td{:colspan => 4}
          %td 
            = t(:tax)
            = @basket.total_tax
          %td 
            = t(:total)
            = euros @basket.total_price

            
    .row.form-actions
      .large-4.column
        = f.submit :class => "submit-button"
      - if @basket.isa :cart 
        .large-2.column
          = link_to t(:back), baskets_path, :class => "admin-button"
        .large-2.column
          = link_to t(:make_order), order_basket_path(@basket), :class => "admin-button"
          = link_to t(:make_purchase), purchase_basket_path(@basket), :class => "admin-button"
          = link_to t(:add_inventory), purchase_basket_path(@basket), :class => "admin-button"
          = link_to t(:as_inventory), purchase_basket_path(@basket), :class => "admin-button"
        .large-2.column
          = link_to t(:print_order), "javascript:poptastic('#{print_basket_path(@basket)}');" , :class => "admin-button"
      - else
        .large-2.column
          = link_to t(:to_order), order_path(@basket.order), :class => "admin-button" if @basket.isa(:order)
        .large-2.column
          = link_to t(:print_order), print_order_path(@basket.order), :class => "admin-button" if @basket.isa(:order)
      .large-2.column
        = link_to t(:destroy) , basket_path(@basket), :data => { :confirm => t(:are_you_sure )}, :method => :delete, :title => t(:destroy) , :class => "admin-button"
